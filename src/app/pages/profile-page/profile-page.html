<app-navbar></app-navbar>

<div class="container" *ngIf="isAuthenticated">

  <div class="card profile-card">
    <div class="card-header">
      <div class="profile-info">
        <h1 class="title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{username}}!</h1>
      </div>

      <div class="avatar" (mouseenter)="hover = true" (mouseleave)="hover = false" (click)="fileInput.click()"
        style="position: relative; cursor: pointer;">
        <tui-avatar size="xxl" class="lg" [src]="avatar || '/assets/icon/no-avatar.jpg'"></tui-avatar>

        <div *ngIf="hover" class="avatar-overlay">
          –ò–∑–º–µ–Ω–∏—Ç—å
        </div>

        <input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)" style="display: none;" />
      </div>
    </div>

    <div class="card-body">
      <p class="description">–≠—Ç–æ –≤–∞—à–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è.</p>
      <p class="description">–í—ã –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≤–æ–µ–º –ø—Ä–æ—Ñ–∏–ª–µ –∑–¥–µ—Å—å.</p>
    </div>

    <button class="btn-edit-profile" (click)="openEditModal()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
    <button class="btn-edit-profile" (click)="testAuth()">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</button>
  </div>

  <div class="card orders-card">
    <h2 class="title orders-title">–ú–æ–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h2>

    <div class="orders" *ngIf="recentOrders.length > 0; else noOrders">
      <app-order-card *ngFor="let order of recentOrders" [order]="order"></app-order-card>
    </div>

    <ng-template #noOrders>
      <div class="no-orders">
        <p class="description">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤ üòî</p>
        <a href="/" class="btn-view-all">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º</a>
      </div>
    </ng-template>

    <div class="all-orders">
      <a href="/delivery" class="btn-view-all">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã</a>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div class="modal-backdrop" *ngIf="isEditModalOpen">
  <div class="modal">
    <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>

    <label>
      –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
      <input type="text" [(ngModel)]="editUsername" />
    </label>

    <label class="file-upload-label">
      <span>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∞–≤–∞—Ç–∞—Ä–∞</span>
      <input type="file" accept="image/*" (change)="onEditFileSelected($event)" />
    </label>

    <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ -->
    <div *ngIf="selectedFileName" class="file-name">
      –í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: {{ selectedFileName }}
    </div>

    <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ -->
    <div *ngIf="editAvatar" class="avatar-preview">
      <tui-avatar size="xl" [src]="editAvatar" alt="–ü—Ä–µ–≤—å—é –∞–≤–∞—Ç–∞—Ä–∞" />
    </div>


    <div class="modal-buttons">
      <button (click)="saveProfile()" class="btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button (click)="cancelEdit()" class="btn-cancel">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>