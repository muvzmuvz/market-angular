<app-navbar></app-navbar>

<div class="container" *ngIf="!isLoading; else loading">
    <button class="back-button" (click)="goBack()">‚Üê –ù–∞–∑–∞–¥</button>

    <div *ngIf="product; else notFound">
        <div class="product-detail">

            <div class="images">
                <img [src]="product.images[activeIndex]?.path" alt="–û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" class="main-image"
                    (click)="isModalOpen = true" />
                <div class="thumbnails">
                    <img *ngFor="let image of product.images; index as i" [src]="image.path" alt="–ú–∏–Ω–∏–∞—Ç—é—Ä–∞"
                        [class.active]="i === activeIndex" (click)="activeIndex = i" />
                </div>
            </div>


            <div class="modal" *ngIf="isModalOpen" (click)="isModalOpen = false">
                <img [src]="modalImage" class="modal-image" alt="–£–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" />
            </div>


            <div class="info">
                <h1>{{ product?.name }}</h1>
                <div class="price-wrapper">
                    <p class="price-discounted" *ngIf="hasDiscount">
                        {{ discountedPrice }} ‚ÇΩ
                        <span class="price-original">{{ product?.price }} ‚ÇΩ</span>
                        <tui-badge size="l" class="discount-percent">-{{ product?.discountPercent }}%</tui-badge>
                    </p>
                    <p class="price" *ngIf="!hasDiscount">
                        {{ product?.price  }} ‚ÇΩ
                    </p>
                </div>
                <p class="description">{{ product?.description }}</p>
                <pre class="characteristics">{{ product?.characteristic }}</pre>
                <p>–ü—Ä–æ–¥–∞–≤–µ—Ü: {{ product.user?.name }}</p>
                <button (click)="addToCart()" [class.added]="isAdded" class="add-button">
                    {{ isAdded ? '‚úî –î–æ–±–∞–≤–ª–µ–Ω–æ' : 'üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É' }}
                </button>
            </div>
        </div>


        <div class="reviews">
            <h2>–û—Ç–∑—ã–≤—ã ({{ comments.length }})</h2>

            <div class="new-review">
                <textarea [(ngModel)]="newComment" placeholder="–í–∞—à –æ—Ç–∑—ã–≤..."></textarea>
                <div class="stars">
                    <span *ngFor="let star of [1,2,3,4,5]" (click)="productEvaluation = star"
                        [class.active]="star <= productEvaluation">‚òÖ</span>
                    <span>{{ productEvaluation }}/5</span>
                </div>
                <button (click)="postComment()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>

            <div class="comment" *ngFor="let comment of comments">
                <div class="comment-header">
                    <tui-avatar [src]="comment.userAvatar || '/assets/icon/no-avatar.jpg' " />
                    <strong>{{ comment.user.name }}</strong>
                    <span>{{ formatDate(comment.dateCreated) }}</span>
                </div>
                <div class="stars">{{ getStars(comment.productEvaluation) }}</div>
                <p>{{ comment.description }}</p>
            </div>
        </div>
    </div>
</div>

<ng-template #loading>
    <div class="loader-overlay">
        <tui-loader size="xl" />
    </div>
</ng-template>


<ng-template #notFound>
    <p class="not-found">–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω.</p>
</ng-template>